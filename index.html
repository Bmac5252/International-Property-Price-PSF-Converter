<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196f3">
    <title>International Property Price Converter</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="/api/placeholder/192/192">
    
    <!-- iOS support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="INTL PP Converter">
    <link rel="apple-touch-icon" href="/api/placeholder/192/192">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 16px;
            background: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 24px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 8px;
            transition: border-color 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #2196f3;
        }
        .result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 24px;
        }
        .result p {
            margin: 12px 0;
            font-size: 18px;
        }
        .total {
            color: #2196f3;
            font-weight: bold;
            font-size: 20px;
        }
        .toggle-group {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 8px;
            width: fit-content;
        }
        .toggle-button {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .toggle-button.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error {
            color: #dc3545;
            padding: 12px;
            background: #ffe6e6;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        .update-time {
            font-size: 12px;
            color: #666;
            text-align: right;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>International Property Price Converter</h1>
        <button id="install-btn" style="display:none;">Install App</button>
        
        <div class="toggle-group" id="input-toggle">
            <button class="toggle-button active" data-unit="sqm">Square Meters</button>
            <button class="toggle-button" data-unit="sqft">Square Feet</button>
            <button class="toggle-button" data-unit="acre">Acres</button>
            <button class="toggle-button" data-unit="hectare">Hectares</button>
            <button class="toggle-button" data-unit="cuadra">Cuadras (CO)</button>
            <button class="toggle-button" data-unit="sqkm">Square Kilometers</button>
            <button class="toggle-button" data-unit="sqmi">Square Miles</button>
        </div>

        <div id="error-message" class="error" style="display: none;"></div>

        <div class="input-group">
            <label for="price">Price per <span id="input-unit-text">sq m</span></label>
            <input type="number" id="price" placeholder="Enter price">
        </div>

        <div class="input-group">
            <label for="currency">Currency</label>
            <select id="currency">
                <option value="USD">Loading currencies...</option>
            </select>
        </div>

        <div class="toggle-group" id="output-toggle">
            <button class="toggle-button" data-unit="sqm">Square Meters</button>
            <button class="toggle-button active" data-unit="sqft">Square Feet</button>
            <button class="toggle-button" data-unit="acre">Acres</button>
            <button class="toggle-button" data-unit="hectare">Hectares</button>
            <button class="toggle-button" data-unit="cuadra">Cuadras (CO)</button>
            <button class="toggle-button" data-unit="sqkm">Square Kilometers</button>
            <button class="toggle-button" data-unit="sqmi">Square Miles</button>
        </div>

        <div class="result">
            <p>Price per <span class="unit-text">sq ft</span>: <span id="converted-price">$0.00</span></p>
            <p class="total">Total for <span id="area-size">1000</span> <span class="unit-text">sq ft</span>: 
                <span id="total-price">$0.00</span>
            </p>
        </div>

        <div class="update-time" id="last-updated"></div>
    </div>

    <script>
        // Constants and state
        const CONVERSION_RATES = {
            sqm: 1,
            sqft: 10.764,           // 1 sqm = 10.764 sqft
            acre: 0.000247105,     // 1 sqm = 0.000247105 acres
            hectare: 0.0001,       // 1 sqm = 0.0001 hectares
            cuadra: 0.00015625,    // 1 sqm = 0.00015625 cuadras (assuming 6400 sqm)
            sqkm: 0.000001,        // 1 sqm = 0.000001 sqkm
            sqmi: 0.000000386102   // 1 sqm = 0.000000386102 sqmi
        };
        let inputUnit = 'sqm';     // Default input unit
        let outputUnit = 'sqft';   // Default output unit
        let exchangeRates = null;
        let lastUpdate = null;

        // DOM elements
        const priceInput = document.getElementById('price');
        const currencySelect = document.getElementById('currency');
        const convertedPrice = document.getElementById('converted-price');
        const totalPrice = document.getElementById('total-price');
        const errorMessage = document.getElementById('error-message');
        const lastUpdated = document.getElementById('last-updated');
        const unitTexts = document.querySelectorAll('.unit-text');
        const inputUnitText = document.getElementById('input-unit-text');
        const areaSize = document.getElementById('area-size');

        // Fetch exchange rates from API
        async function fetchExchangeRates() {
            try {
                currencySelect.innerHTML = '<option value="">Loading currencies...</option>';
                currencySelect.disabled = true;
                
                const response = await fetch('https://v6.exchangerate-api.com/v6/bd5a904113f08d2c2a94bc51/latest/USD');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.conversion_rates) {
                    exchangeRates = data.conversion_rates;
                    lastUpdate = new Date();
                    updateCurrencySelect();
                    updateLastUpdated();
                    currencySelect.disabled = false;
                    calculatePrices();
                    return true;
                }
                throw new Error('Invalid rate data');
            } catch (error) {
                console.error('Exchange rate error:', error);
                showError('Failed to fetch exchange rates. Please try again later.');
                currencySelect.innerHTML = '<option value="">Error loading currencies</option>';
                return false;
            }
        }

        // Update currency select options
        function updateCurrencySelect() {
            if (!exchangeRates) {
                currencySelect.innerHTML = '<option value="">No exchange rates available</option>';
                return;
            }
            
            const currencies = Object.keys(exchangeRates).sort();
            const options = currencies.map(currency => {
                const name = getCurrencyName(currency);
                const label = name ? `${currency} - ${name}` : currency;
                return `<option value="${currency}">${label}</option>`;
            });
            
            currencySelect.innerHTML = options.join('');
            
            const defaultCurrency = localStorage.getItem('lastSelectedCurrency') || 'EUR';
            if (currencies.includes(defaultCurrency)) {
                currencySelect.value = defaultCurrency;
            }
            
            currencySelect.addEventListener('change', (e) => {
                localStorage.setItem('lastSelectedCurrency', e.target.value);
            });
        }

        // Get full currency names
        function getCurrencyName(code) {
            const names = {
                USD: 'US Dollar', EUR: 'Euro', GBP: 'British Pound',
                JPY: 'Japanese Yen', AUD: 'Australian Dollar',
                CAD: 'Canadian Dollar', THB: 'Thai Baht',
                COP: 'Colombian Peso', MXN: 'Mexican Peso'
            };
            return names[code] || code;
        }

        // Calculate and display prices
        function calculatePrices() {
            const price = parseFloat(priceInput.value) || 0;
            const currency = currencySelect.value;
            
            if (!exchangeRates || !exchangeRates[currency]) {
                showError('Exchange rate not available');
                return;
            }

            // Convert to USD per input unit
            const usdPrice = price / exchangeRates[currency];
            const usdPerSqm = usdPrice / CONVERSION_RATES[inputUnit]; // Normalize to USD/sqm
            const displayPrice = usdPerSqm / CONVERSION_RATES[outputUnit]; // Convert to output unit

            // Set total area based on output unit (approximate reasonable sizes)
            const totalAreas = {
                sqm: 100,      // 100 sqm
                sqft: 1000,    // 1000 sqft
                acre: 1,       // 1 acre
                hectare: 1,    // 1 hectare
                cuadra: 1,     // 1 cuadra
                sqkm: 0.1,     // 0.1 sqkm
                sqmi: 0.1      // 0.1 sqmi
            };
            const totalArea = totalAreas[outputUnit];

            // Update display
            convertedPrice.textContent = `$${displayPrice.toFixed(2)}`;
            areaSize.textContent = totalArea;
            totalPrice.textContent = `$${(displayPrice * totalArea).toFixed(2)}`;
        }

        // Toggle input unit
        document.querySelectorAll('#input-toggle .toggle-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('#input-toggle .toggle-button').forEach(b => 
                    b.classList.remove('active'));
                button.classList.add('active');
                inputUnit = button.dataset.unit;
                inputUnitText.textContent = getUnitDisplay(inputUnit);
                calculatePrices();
            });
        });

        // Toggle output unit
        document.querySelectorAll('#output-toggle .toggle-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('#output-toggle .toggle-button').forEach(b => 
                    b.classList.remove('active'));
                button.classList.add('active');
                outputUnit = button.dataset.unit;
                unitTexts.forEach(text => text.textContent = getUnitDisplay(outputUnit));
                calculatePrices();
            });
        });

        // Helper function for unit display text
        function getUnitDisplay(unit) {
            const displays = {
                sqm: 'sq m',
                sqft: 'sq ft',
                acre: 'acre',
                hectare: 'hectare',
                cuadra: 'cuadra',
                sqkm: 'sq km',
                sqmi: 'sq mi'
            };
            return displays[unit];
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function updateLastUpdated() {
            if (lastUpdate) {
                lastUpdated.textContent = `Rates last updated: ${lastUpdate.toLocaleString()}`;
            }
        }

        // Add event listeners
        priceInput.addEventListener('input', calculatePrices);
        currencySelect.addEventListener('change', calculatePrices);

        // Initialize
        fetchExchangeRates();
        setInterval(fetchExchangeRates, 3600000); // Update rates every hour

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
    
        // Constants and state
        const SQMETER_TO_SQFT = 10.764;
        let currentUnit = 'sqft';
        let exchangeRates = null;
        let lastUpdate = null;

        // DOM elements
        const priceInput = document.getElementById('price');
        const currencySelect = document.getElementById('currency');
        const convertedPrice = document.getElementById('converted-price');
        const totalPrice = document.getElementById('total-price');
        const errorMessage = document.getElementById('error-message');
        const lastUpdated = document.getElementById('last-updated');
        const unitTexts = document.querySelectorAll('.unit-text');
        const areaSize = document.getElementById('area-size');

        // Fetch exchange rates from API
        async function fetchExchangeRates() {
            try {
                currencySelect.innerHTML = '<option value="">Loading currencies...</option>';
                currencySelect.disabled = true;
                
                const response = await fetch('https://v6.exchangerate-api.com/v6/bd5a904113f08d2c2a94bc51/latest/USD');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.conversion_rates) {
                    exchangeRates = data.conversion_rates;
                    lastUpdate = new Date();
                    updateCurrencySelect();
                    updateLastUpdated();
                    currencySelect.disabled = false;
                    calculatePrices(); // Add this line to trigger initial calculation
                    return true;
                }
                throw new Error('Invalid rate data');
            } catch (error) {
                console.error('Exchange rate error:', error);
                showError('Failed to fetch exchange rates. Please try again later.');
                currencySelect.innerHTML = '<option value="">Error loading currencies</option>';
                return false;
            }
        }

        // Update currency select options
        function updateCurrencySelect() {
            if (!exchangeRates) {
                currencySelect.innerHTML = '<option value="">No exchange rates available</option>';
                return;
            }
            
            const currencies = Object.keys(exchangeRates).sort();
            const options = currencies.map(currency => {
                const name = getCurrencyName(currency);
                const label = name ? `${currency} - ${name}` : currency;
                return `<option value="${currency}">${label}</option>`;
            });
            
            currencySelect.innerHTML = options.join('');
            
            // Select a default currency (e.g., EUR or the last selected currency)
            const defaultCurrency = localStorage.getItem('lastSelectedCurrency') || 'EUR';
            if (currencies.includes(defaultCurrency)) {
                currencySelect.value = defaultCurrency;
            }
            
            // Store selected currency for next time
            currencySelect.addEventListener('change', (e) => {
                localStorage.setItem('lastSelectedCurrency', e.target.value);
            });
        }

        // Get full currency names
        function getCurrencyName(code) {
            const names = {
                USD: 'US Dollar', EUR: 'Euro', GBP: 'British Pound',
                JPY: 'Japanese Yen', AUD: 'Australian Dollar',
                CAD: 'Canadian Dollar', THB: 'Thai Baht',
                COP: 'Colombian Peso', MXN: 'Mexican Peso'
                // Add more as needed
            };
            return names[code] || code;
        }

        // Calculate and display prices
        function calculatePrices() {
            const price = parseFloat(priceInput.value) || 0;
            const currency = currencySelect.value;
            
            if (!exchangeRates || !exchangeRates[currency]) {
                showError('Exchange rate not available');
                return;
            }

            // Convert to USD
            const usdPrice = price / exchangeRates[currency];
            
            // Convert based on selected unit
            let displayPrice, totalArea;
            if (currentUnit === 'sqft') {
                displayPrice = usdPrice / SQMETER_TO_SQFT;
                totalArea = 1000;
            } else {
                displayPrice = usdPrice;
                totalArea = 100; // Show total for 100 square meters
            }
            
            // Update display
            convertedPrice.textContent = `$${displayPrice.toFixed(2)}`;
            areaSize.textContent = totalArea;
            totalPrice.textContent = `$${(displayPrice * totalArea).toFixed(2)}`;
        }

        // Toggle between square feet and square meters
        document.querySelectorAll('.toggle-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.toggle-button').forEach(b => 
                    b.classList.remove('active'));
                button.classList.add('active');
                currentUnit = button.dataset.unit;
                unitTexts.forEach(text => text.textContent = 
                    currentUnit === 'sqft' ? 'sq ft' : 'sq m');
                calculatePrices();
            });
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function updateLastUpdated() {
            if (lastUpdate) {
                lastUpdated.textContent = `Rates last updated: ${lastUpdate.toLocaleString()}`;
            }
        }

        // Add event listeners
        priceInput.addEventListener('input', calculatePrices);
        currencySelect.addEventListener('change', calculatePrices);

        // Initialize
        fetchExchangeRates();
        setInterval(fetchExchangeRates, 3600000); // Update rates every hour

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
    
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });
    
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                await deferredPrompt.userChoice;
                deferredPrompt = null;
            }
        });
    </script>
</body>
</html>
